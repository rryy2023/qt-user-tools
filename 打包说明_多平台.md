# 多平台打包说明

本工具支持一次性打包为多个平台的应用。

## 📦 支持的平台

- **macOS ARM64** (Apple Silicon, M1/M2/M3)
- **macOS Intel** (x86_64)
- **Windows** (EXE)

## 🚀 使用方法

### macOS 打包

在 macOS 上运行 `build_all_platforms.sh` 脚本：

```bash
# 只打包 macOS ARM64 (M1/M2)
./build_all_platforms.sh --mac-arm64

# 只打包 macOS Intel
./build_all_platforms.sh --mac-intel

# 同时打包 macOS 两种架构
./build_all_platforms.sh --mac-arm64 --mac-intel

# 打包所有平台（包括 Windows，需要 Wine）
./build_all_platforms.sh --all

# 查看帮助
./build_all_platforms.sh --help
```

### Windows 打包

在 Windows 上运行 `build_windows.bat` 脚本：

```batch
build_windows.bat
```

## 📁 输出目录

打包完成后，文件会输出到以下目录：

```
dist/
├── mac_arm64/
│   ├── 千图网问题解决工具.app
│   └── 千图网问题解决工具_V0.0.1_ARM64.dmg
├── mac_intel/
│   ├── 千图网问题解决工具.app
│   └── 千图网问题解决工具_V0.0.1_Intel.dmg
└── windows/
    └── 千图网问题解决工具.exe
```

## ⚙️ 打包要求

### macOS 打包要求

1. **Python 3.8+**
   - ARM64 版本：用于打包 M1/M2 版本
   - x86_64 版本：用于打包 Intel 版本（在 Apple Silicon Mac 上可通过 Rosetta 2 运行）

2. **依赖包**
   - PyQt6
   - PyInstaller
   - beautifulsoup4
   - lxml
   - requests
   - netifaces

3. **系统工具**
   - `hdiutil`（用于创建 DMG，macOS 自带）

### Windows 打包要求

1. **Python 3.8+**（Windows 版本）
2. **依赖包**（同 macOS）
3. **PyInstaller**

## 🔧 打包流程

### macOS ARM64 打包流程

1. 自动检测 ARM64 Python 环境
2. 安装依赖包
3. 使用 PyInstaller 打包为 `.app`
4. 创建 DMG 安装包

### macOS Intel 打包流程

1. 在 Apple Silicon Mac 上：
   - 使用 `arch -x86_64` 运行 Python（通过 Rosetta 2）
   - 或查找已安装的 x86_64 Python
2. 在 Intel Mac 上：
   - 直接使用当前 Python 环境
3. 后续流程同 ARM64

### Windows 打包流程

1. 检查 Python 环境
2. 安装依赖包
3. 使用 PyInstaller 打包为 `.exe`

## ⚠️ 注意事项

1. **架构匹配**
   - 确保使用的 Python 架构与目标平台匹配
   - 在 Apple Silicon Mac 上打包 Intel 版本需要 Rosetta 2 支持

2. **依赖安装**
   - 脚本会自动安装依赖，但建议先手动安装以确保环境正确

3. **Windows 打包**
   - 在 macOS/Linux 上无法直接打包 Windows 版本
   - 需要在 Windows 系统上运行 `build_windows.bat`
   - 或使用 Wine（不推荐，可能不稳定）

4. **代码签名**
   - macOS 版本使用 ad-hoc 签名
   - 如需正式签名，需要修改脚本中的签名配置

## 🐛 常见问题

### Q: 在 Apple Silicon Mac 上无法打包 Intel 版本？

A: 确保已安装 Rosetta 2，并尝试：
```bash
# 安装 x86_64 Python（通过 Rosetta 2）
arch -x86_64 /usr/bin/python3 --version
```

### Q: 打包失败，提示缺少模块？

A: 检查 `requirements.txt` 是否包含所有依赖，并手动安装：
```bash
pip install -r requirements.txt
```

### Q: Windows 打包在 macOS 上失败？

A: 这是正常的。Windows 版本必须在 Windows 系统上打包，或使用 Wine（不推荐）。

## 📝 版本信息

- 当前版本：V0.0.1
- 最后更新：2024-01-24
